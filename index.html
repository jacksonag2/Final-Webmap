<!DOCTYPE html>
<html>
  <head>
    <title>Average US Temperature Increase (Late 19th to Early 21st Century)</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        background-color: #fafafa;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .info {
        z-index: 1000;
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 10px 14px;
        font-size: 14px;
        background: rgba(255, 255, 255, 0.92);
        border: 1px solid rgba(200, 200, 200, 0.4);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        border-radius: 10px;
        line-height: 1.5;
        color: #222;
      }

      .info h4 {
        font-size: 15px;
        font-weight: 600;
        margin: 0 0 6px;
      }

      .legend {
        text-align: left;
        line-height: 1.4;
        color: #222;
        background: rgba(255, 255, 255, 0.92);
        border: 1px solid rgba(200, 200, 200, 0.4);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 13px;
      }

      .legend i {
        width: 18px;
        height: 14px;
        float: left;
        margin-right: 8px;
        opacity: 0.8;
        border-radius: 3px;
      }
    </style>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  </head>

  <body>

    <body>
  <!-- Top-Center Title Box -->
  <div class="title-box">
    Average US State Temperature Rise (1896–2023)
  </div>

  <div id="map"></div>

  <style>
    /* Title Box Styling (white background, black text) */
    .title-box {
      position: absolute;
      top: 20px;                 /* distance from top */
      left: 50%;
      transform: translateX(-50%); /* center horizontally */
      width: 80%;                /* wide but not full screen */
      max-width: 900px;
      padding: 15px 0;
      text-align: center;
      background-color: white;    /* white background */
      color: #222;                /* black text, matches other boxes */
      font-size: 1.8rem;
      font-weight: bold;
      border-radius: 12px;
      border: 1px solid rgba(200, 200, 200, 0.4); /* subtle border like other boxes */
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);    /* consistent shadow */
      z-index: 1001; /* above map and info controls */
    }
  </style>

    <style>
  /* Unified black outline for all text boxes / controls */
  .info,
  .legend,
  .compass,
  .legend-toggle,
  .title-box,
  .leaflet-control-attribution {
    border: 1px solid #000 !important; /* small black outline */
  }

  /* Optional: maintain rounded corners for consistency */
  .info,
  .legend,
  .compass,
  .title-box {
    border-radius: 10px;
  }

  /* Ensure toggle buttons keep current styling */
  .legend-toggle {
    border-radius: 4px;
  }
</style>

    <script>
      // --- 1. Create the map ---
      const map = L.map('map').setView([37.8, -96], 5);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

      // --- 2. Color scale ---
      const grades = [0.01, 1.01, 2.01, 3.01, 4.01, 5.01];
      const colors = chroma.scale(['#fee5d9', '#fcae91', '#de2d26']).mode('lab').colors(grades.length);

      function getColor(d) {
        for (let i = 0; i < grades.length - 1; i++) {
          if (d > grades[i] && d <= grades[i + 1]) return colors[i];
        }
        return colors[colors.length - 1];
      }

      function style(feature) {
        return {
          weight: 1.2,
          opacity: 1,
          color: '#b2b2b2',
          dashArray: '2',
          fillOpacity: 0.75,
          fillColor: getColor(feature.properties["temperature increase"])
        };
      }

      // --- 3. Info Box ---
      const info = L.control({ position: 'topright' });

      info.onAdd = function () {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
      };

      info.update = function (props) {
        this._div.innerHTML =
          '<h4>US Temperature Increase by State</h4>' +
          (props
            ? `<b>${props.name}</b><br/>Temperature Increase: <strong>${props["temperature increase"]}</strong>`
            : 'Hover over a state');
      };

      info.addTo(map);

      // --- Instructional Tab ---
const instruction = L.control({ position: 'topright' });

instruction.onAdd = function () {
  const div = L.DomUtil.create('div', 'info');
  div.style.top = '225px'; // moved further down
  div.style.right = '20px';
  div.style.position = 'absolute';
  div.style.fontSize = '12px';
  div.style.background = 'rgba(255,255,255,0.85)';
  div.style.textAlign = 'center';
  div.style.width = '120px';
  div.style.padding = '6px';
  div.style.borderRadius = '6px';
  div.innerHTML = 'Click on heatwave icons to see details';
  return div;
};


// --- Compass Control ---
const compass = L.control({ position: 'topleft' });

compass.onAdd = function () {
  const div = L.DomUtil.create('div', 'compass');
  div.innerHTML = `
    <div style="text-align:center; font-weight:bold; font-family:Inter, sans-serif; background: rgba(255,255,255,0.85); padding: 6px 10px; border-radius: 6px; box-shadow: 0 1px 5px rgba(0,0,0,0.3);">
      <div>N</div>
      <div style="display:flex; justify-content: space-between; width: 40px;">
        <div>W</div>
        <div>E</div>
      </div>
      <div>S</div>
    </div>
  `;
  return div;
};

compass.addTo(map);


instruction.addTo(map);


      // --- 4. Interactivity ---
      function highlightFeature(e) {
        const layer = e.target;
        layer.setStyle({
          weight: 2.5,
          color: '#2a4d7a',
          fillColor: '#1c5ee3',
          fillOpacity: 0.55
        });
        layer.bringToFront();
        info.update(layer.feature.properties);
      }

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
        info.update();
      }

      function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
      }

      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature
        });
      }

      // --- 5. Load US States ---
      const geojson = L.geoJson.ajax("assets/us-states.geojson", {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map);

      // --- Heatwave Points Layer (Font Awesome Icons by Severity) ---
const heatwave = {
  "type": "FeatureCollection",
  "features": [
    { "type": "Feature", "properties": { "event": "Boston Heatwave", "temp_peak": 99, "heat_index": 108 }, "geometry": { "type": "Point", "coordinates": [-71.0589, 42.3601] } },
    { "type": "Feature", "properties": { "event": "Philadelphia Heatwave", "temp_peak": 101, "heat_index": 110 }, "geometry": { "type": "Point", "coordinates": [-75.1652, 39.9526] } },
    { "type": "Feature", "properties": { "event": "Raleigh Heatwave", "temp_peak": 103, "heat_index": 112 }, "geometry": { "type": "Point", "coordinates": [-78.6382, 35.7796] } },
    { "type": "Feature", "properties": { "event": "Tampa Heatwave", "temp_peak": 102, "heat_index": 111 }, "geometry": { "type": "Point", "coordinates": [-82.4572, 27.9506] } },
    { "type": "Feature", "properties": { "event": "Miami Heatwave", "temp_peak": 100, "heat_index": 109 }, "geometry": { "type": "Point", "coordinates": [-80.1918, 25.7617] } },
    { "type": "Feature", "properties": { "event": "San Juan Heatwave", "temp_peak": 97, "heat_index": 105 }, "geometry": { "type": "Point", "coordinates": [-66.1057, 18.4655] } },
    { "type": "Feature", "properties": { "event": "Columbus Heatwave", "temp_peak": 101, "heat_index": 110 }, "geometry": { "type": "Point", "coordinates": [-82.9988, 39.9612] } },
    { "type": "Feature", "properties": { "event": "Pittsburgh Heatwave", "temp_peak": 100, "heat_index": 108 }, "geometry": { "type": "Point", "coordinates": [-79.9959, 40.4406] } },
    { "type": "Feature", "properties": { "event": "Cleveland Heatwave", "temp_peak": 102, "heat_index": 110 }, "geometry": { "type": "Point", "coordinates": [-81.6944, 41.4993] } },
    { "type": "Feature", "properties": { "event": "Detroit Heatwave", "temp_peak": 101, "heat_index": 109 }, "geometry": { "type": "Point", "coordinates": [-83.0458, 42.3314] } },
    { "type": "Feature", "properties": { "event": "St. Louis Heatwave", "temp_peak": 104, "heat_index": 113 }, "geometry": { "type": "Point", "coordinates": [-90.1994, 38.6270] } },
    { "type": "Feature", "properties": { "event": "New Orleans Heatwave", "temp_peak": 103, "heat_index": 112 }, "geometry": { "type": "Point", "coordinates": [-90.0715, 29.9511] } },
    { "type": "Feature", "properties": { "event": "Tulsa Heatwave", "temp_peak": 105, "heat_index": 114 }, "geometry": { "type": "Point", "coordinates": [-95.9928, 36.15398] } },
    { "type": "Feature", "properties": { "event": "Oklahoma City Heatwave", "temp_peak": 104, "heat_index": 113 }, "geometry": { "type": "Point", "coordinates": [-97.5164, 35.4676] } },
    { "type": "Feature", "properties": { "event": "Fort Worth Heatwave", "temp_peak": 105, "heat_index": 115 }, "geometry": { "type": "Point", "coordinates": [-97.3308, 32.7555] } },
    { "type": "Feature", "properties": { "event": "Austin Heatwave", "temp_peak": 104, "heat_index": 113 }, "geometry": { "type": "Point", "coordinates": [-97.7431, 30.2672] } },
    { "type": "Feature", "properties": { "event": "Salt Lake City Heatwave", "temp_peak": 101, "heat_index": 109 }, "geometry": { "type": "Point", "coordinates": [-111.8910, 40.7608] } },
    { "type": "Feature", "properties": { "event": "Las Vegas Heatwave", "temp_peak": 110, "heat_index": 115 }, "geometry": { "type": "Point", "coordinates": [-115.1398, 36.1699] } },
    { "type": "Feature", "properties": { "event": "Phoenix Heatwave", "temp_peak": 112, "heat_index": 118 }, "geometry": { "type": "Point", "coordinates": [-112.0740, 33.4484] } },
    { "type": "Feature", "properties": { "event": "Honolulu Heatwave", "temp_peak": 95, "heat_index": 102 }, "geometry": { "type": "Point", "coordinates": [-157.8583, 21.3069] } }
  ]
};

// Assign color by heat index
function getHeatwaveColor(heatIndex) {
  if (heatIndex < 110) return "#FFD700";   // bright yellow
  if (heatIndex <= 114) return "#FF8C00";  // bright orange
  return "#FF0000";                        // bright red
}

// Add heatwave points to the map
const heatLayer = L.geoJSON(heatwave, {
  pointToLayer: function(feature, latlng) {
    const color = getHeatwaveColor(feature.properties.heat_index);
    return L.marker(latlng, {
      icon: L.divIcon({
        html: `<div style="text-align:center;">
                 <i class="fa-solid fa-temperature-arrow-up" style="color:${color}; font-size:24px;"></i>
               </div>`,
        className: ''
      })
    });
  },
  onEachFeature: function(feature, layer) {
    layer.bindPopup(
      `<b>${feature.properties.event}</b><br>
       Peak Temp: ${feature.properties.temp_peak}°F<br>
       Heat Index: ${feature.properties.heat_index}°F`
    );
  }
}).addTo(map).bringToFront();


// --- 7. Updated Legend with Temperature + Heatwave Severity ---
const legend = L.control({ position: 'bottomleft' });

legend.onAdd = function () {
  const div = L.DomUtil.create('div', 'legend');

  // --- Temperature Increase Section ---
  div.innerHTML += '<strong>Temperature Increase (°F)</strong><br>';
  for (let i = 0; i < grades.length - 1; i++) {
    div.innerHTML += `<i style="background:${colors[i]}"></i> ${grades[i]} – ${grades[i + 1]}<br>`;
  }
  div.innerHTML += `<i style="background:${colors[colors.length - 1]}"></i> ${grades[grades.length - 1]}+<br>`;

  // --- Heatwave Severity Section ---
div.innerHTML += '<b>Heatwave Severity (Heat Index)</b><br>';
  div.innerHTML += '<i class="fa-solid fa-temperature-arrow-up" style="color:#FFD700;"></i> < 110°F<br>';
  div.innerHTML += '<i class="fa-solid fa-temperature-arrow-up" style="color:#FF8C00;"></i> 110–114°F<br>';
  div.innerHTML += '<i class="fa-solid fa-temperature-arrow-up" style="color:#FF0000;"></i> > 114°F<br>';
  return div;
};

legend.addTo(map);


// --- Toggle Information Button ---
const toggleInfoBtn = L.control({ position: 'topright' });

toggleInfoBtn.onAdd = function () {
  const btn = L.DomUtil.create('button', 'legend-toggle');
  btn.innerHTML = 'Toggle Info Boxes';
  btn.style.padding = '6px 10px';
  btn.style.background = '#fff';
  btn.style.border = '1px solid #ccc';
  btn.style.borderRadius = '4px';
  btn.style.cursor = 'pointer';
  // Initial position below the instructional box
  btn.style.position = 'absolute';
  btn.style.right = '20px';
  btn.style.top = '290px'; // adjust based on spacing

  btn.onclick = function () {
    const infoDiv = document.querySelector('.info'); // temperature info
    const instrDiv = document.querySelectorAll('.info')[1]; // click-on-heatwaves info

    if (infoDiv && instrDiv) {
      const hidden = infoDiv.style.display === 'none';
      // Toggle display
      infoDiv.style.display = hidden ? 'block' : 'none';
      instrDiv.style.display = hidden ? 'block' : 'none';
      
      // Move button
      if (hidden) {
        // Info boxes visible -> button below info
        btn.style.top = '290px';
      } else {
        // Info boxes hidden -> move button to top right corner
        btn.style.top = '20px';
      }
    }
  };

  return btn;
};

toggleInfoBtn.addTo(map);



      // --- Toggle Button ---
      const toggleBtn = L.control({ position: 'bottomleft' });
      toggleBtn.onAdd = function () {
        const btn = L.DomUtil.create('button', 'legend-toggle');
        btn.innerHTML = 'Toggle Legend';
        btn.style.padding = '6px 10px';
        btn.style.marginBottom = '8px';
        btn.style.background = '#fff';
        btn.style.border = '1px solid #ccc';
        btn.style.borderRadius = '4px';
        btn.style.cursor = 'pointer';

        btn.onclick = function () {
          const legendDiv = document.querySelector('.legend');
          legendDiv.style.display =
            legendDiv.style.display === 'none' ? 'block' : 'none';
        };

        return btn;
      };
      toggleBtn.addTo(map);

      map.attributionControl.setPrefix(false); // remove default Leaflet link
      map.attributionControl.addAttribution('Created by Aiden Jackson using');
      map.attributionControl.addAttribution(
  '<a href="https://leafletjs.com/" target="_blank">Leaflet</a>');
map.attributionControl.addAttribution(
  '<a href="https://www.ncei.noaa.gov/" target="_blank">NOAA NCEI</a>'
);
map.attributionControl.addAttribution(
  '<a href="https://www.epa.gov/" target="_blank">US EPA</a>'
);

    </script>
  </body>
</html>
